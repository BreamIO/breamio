<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<style>
	        html,
			body {
				width: 100%;
				height: 100%;
				margin: 0;
			}
			canvas {
				background: #FFFFFF;
				display: block;
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
			}
		</style>
		<title>Bream IO Eriver Tracker Drawer</title>
		<script>
			var size = {
				x: 500,
				y: 300
			};
			var socket;
			function listen(addr) {
				'use strict';
				socket = new WebSocket(addr);
				socket.onopen = function() {
					'use strict';
					console.log("Socket opened.");
					socket.send(JSON.stringify({
						Event: "tracker:etdata",
						Subscribe: true,
						ID: {{.}}
						}));
				};

				socket.onmessage = function (message) {
					'use strict';
					var event = JSON.parse(message.data);
					// console.log(event);
					if (event.Error !== undefined && event.Error !== null) {
						console.log(event.Error);
						return;
					}
					if (event.Event === "tracker:etdata") {
						/*console.log({
								raw: event.Data,
								btoa: btoa(event.Data),
								atob: atob(event.Data)
							})*/
						var etdata = JSON.parse(atob(event.Data));
						render(etdata)
					}
				};

				socket.onclose = function() {
					'use strict';
					console.log("Socket closed.")
				};
			}

			function render(etdata) {
				'use strict';
				//ctx.clearRect(0,0,drawer.width,drawer.height)
				
				ctx.fillStyle = "#FF0000";
				ctx.beginPath();
				ctx.arc(size.x*etdata.Filtered.Xf,size.y*etdata.Filtered.Yf,10,0,2*Math.PI);
				ctx.fill();
			}

			function fade() {
				'use strict';
				ctx.fillStyle = "rgba(255,255,255,0.2)"
				ctx.fillRect(0,0,drawer.width,drawer.height)
			}
		</script>
	</head>
<body>
<canvas id="drawer" width="1024" height="600">
</canvas>
</body>
<script>
	drawer = document.getElementById("drawer")
	ctx = drawer.getContext("2d")
	listen("ws://localhost:8080")
	setInterval(fade, 10)
</script>
</html>